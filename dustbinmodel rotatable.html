<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D Smart Dustbin Model</title>
    <style>
        body { margin: 0; overflow: hidden; font-family: 'Segoe UI', sans-serif; background: #2c3e50; }
        
        /* UI Overlay */
        #ui-container {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 10px;
            background: rgba(255, 255, 255, 0.9);
            padding: 10px;
            border-radius: 30px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            z-index: 100;
        }

        button {
            border: none;
            padding: 10px 20px;
            border-radius: 20px;
            cursor: pointer;
            font-weight: bold;
            background: #eee;
            transition: 0.3s;
        }

        button:hover { background: #ddd; }
        button.active { background: #2c3e50; color: white; }

        #info-panel {
            position: absolute;
            bottom: 20px;
            left: 20px;
            color: white;
            background: rgba(0,0,0,0.6);
            padding: 20px;
            border-radius: 10px;
            max-width: 300px;
            pointer-events: none;
        }

        #loading {
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 24px;
        }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
</head>
<body>

    <div id="loading">Loading 3D Engine...</div>

    <div id="ui-container">
        <button onclick="setMode(1)" class="active" id="btn1">1. Exterior</button>
        <button onclick="setMode(2)" id="btn2">2. X-Ray Sensor</button>
        <button onclick="setMode(3)" id="btn3">3. Recycle</button>
        <button onclick="setMode(4)" id="btn4">4. Organic</button>
    </div>

    <div id="info-panel">
        <h3 id="panel-title">Smart Bin Exterior</h3>
        <p id="panel-desc">Drag to rotate. Shows digital screen (85%), GPS tracker, and sturdy wheels for mobility.</p>
    </div>

    <script>
        // --- 1. SCENE SETUP ---
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0xf0f2f5);

        const camera = new THREE.PerspectiveCamera(50, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera.position.set(0, 15, 30); // Look from above/front

        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.shadowMap.enabled = true;
        document.body.appendChild(renderer.domElement);

        // Remove loading text
        document.getElementById('loading').style.display = 'none';

        // Lighting
        const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
        scene.add(ambientLight);

        const dirLight = new THREE.DirectionalLight(0xffffff, 0.8);
        dirLight.position.set(10, 20, 10);
        dirLight.castShadow = true;
        scene.add(dirLight);

        // Orbit Controls (Mouse rotation)
        const controls = new THREE.OrbitControls(camera, renderer.domElement);
        controls.enableDamping = true;
        controls.dampingFactor = 0.05;

        // --- 2. BUILD THE DUSTBIN ---
        
        // Group to hold all bin parts
        const binGroup = new THREE.Group();
        scene.add(binGroup);

        // A. Main Body
        const bodyGeo = new THREE.CylinderGeometry(4, 3.5, 10, 32);
        const bodyMat = new THREE.MeshPhongMaterial({ color: 0x555555, transparent: true, opacity: 1 });
        const binBody = new THREE.Mesh(bodyGeo, bodyMat);
        binBody.position.y = 6;
        binBody.castShadow = true;
        binGroup.add(binBody);

        // B. Lid
        const lidGeo = new THREE.CylinderGeometry(4.2, 4.2, 1, 32);
        const lidMat = new THREE.MeshPhongMaterial({ color: 0x333333 });
        const binLid = new THREE.Mesh(lidGeo, lidMat);
        binLid.position.y = 11.5;
        binGroup.add(binLid);

        // C. Smart Screen (Canvas Texture)
        const canvas = document.createElement('canvas');
        canvas.width = 256; canvas.height = 128;
        const ctx = canvas.getContext('2d');
        // Draw screen background
        ctx.fillStyle = "black"; ctx.fillRect(0,0,256,128);
        ctx.strokeStyle = "#444"; ctx.lineWidth = 10; ctx.strokeRect(0,0,256,128);
        // Draw Text
        ctx.fillStyle = "#0f0"; ctx.font = "bold 40px Courier New"; ctx.fillText("85% FULL", 30, 50);
        ctx.font = "20px Arial"; ctx.fillStyle = "white"; ctx.fillText("GPS: ON | WiFi", 60, 90);
        
        const screenTexture = new THREE.CanvasTexture(canvas);
        const screenGeo = new THREE.PlaneGeometry(3, 1.5);
        const screenMat = new THREE.MeshBasicMaterial({ map: screenTexture });
        const screenMesh = new THREE.Mesh(screenGeo, screenMat);
        screenMesh.position.set(0, 11.6, 4.15); // Place on front of lid
        // Slight tilt
        screenMesh.rotation.x = -0.1;
        binGroup.add(screenMesh);

        // D. QR Code Placeholder
        const qrCanvas = document.createElement('canvas');
        qrCanvas.width = 128; qrCanvas.height = 128;
        const qx = qrCanvas.getContext('2d');
        qx.fillStyle = "white"; qx.fillRect(0,0,128,128);
        qx.fillStyle = "black"; 
        // Fake QR pattern
        qx.fillRect(10,10,40,40); qx.fillRect(78,10,40,40); qx.fillRect(10,78,40,40);
        qx.fillRect(60,60,20,20); qx.fillRect(30,60,10,10); qx.fillRect(80,80,20,30);
        
        const qrTexture = new THREE.CanvasTexture(qrCanvas);
        const qrGeo = new THREE.PlaneGeometry(3, 3);
        const qrMat = new THREE.MeshBasicMaterial({ map: qrTexture });
        const qrMesh = new THREE.Mesh(qrGeo, qrMat);
        qrMesh.position.set(0, 6, 3.6); // Front of body
        // Curve it slightly to fit cylinder? (Plane is fine for simple view)
        binGroup.add(qrMesh);

        // E. Wheels
        const wheelGeo = new THREE.CylinderGeometry(1.2, 1.2, 1, 32);
        const wheelMat = new THREE.MeshLambertMaterial({ color: 0x111111 });
        
        const wheelL = new THREE.Mesh(wheelGeo, wheelMat);
        wheelL.rotation.z = Math.PI / 2;
        wheelL.position.set(-3, 1.2, 0);
        binGroup.add(wheelL);

        const wheelR = new THREE.Mesh(wheelGeo, wheelMat);
        wheelR.rotation.z = Math.PI / 2;
        wheelR.position.set(3, 1.2, 0);
        binGroup.add(wheelR);

        // F. Internal Sensor Beam (Hidden by default)
        const beamGeo = new THREE.ConeGeometry(2.5, 8, 32, 1, true); // Open ended cone
        const beamMat = new THREE.MeshBasicMaterial({ color: 0xff0000, transparent: true, opacity: 0.2, side: THREE.DoubleSide });
        const sensorBeam = new THREE.Mesh(beamGeo, beamMat);
        sensorBeam.position.set(0, 7, 0); 
        sensorBeam.visible = false;
        binGroup.add(sensorBeam);

        // G. Cooling Unit (Hidden by default)
        const coolerGeo = new THREE.BoxGeometry(4, 2, 4);
        const coolerMat = new THREE.MeshStandardMaterial({ color: 0x3498db }); // Blue cooler
        const coolerUnit = new THREE.Mesh(coolerGeo, coolerMat);
        coolerUnit.position.set(0, 2, 0);
        coolerUnit.visible = false;
        binGroup.add(coolerUnit);

        // --- 3. ANIMATION LOOP ---
        function animate() {
            requestAnimationFrame(animate);
            controls.update();

            // Rotate beam if visible
            if(sensorBeam.visible) {
                sensorBeam.rotation.y += 0.01;
                sensorBeam.material.opacity = 0.2 + Math.sin(Date.now() * 0.005) * 0.1; // Pulse effect
            }

            renderer.render(scene, camera);
        }
        animate();

        // --- 4. INTERACTION LOGIC ---
        function setMode(mode) {
            // Reset UI buttons
            document.querySelectorAll('button').forEach(b => b.classList.remove('active'));
            document.getElementById('btn' + mode).classList.add('active');

            // Reset Model State
            binBody.material.opacity = 1;
            binBody.material.wireframe = false;
            binBody.material.color.setHex(0x555555);
            screenMesh.visible = true;
            qrMesh.visible = true;
            sensorBeam.visible = false;
            coolerUnit.visible = false;

            const title = document.getElementById('panel-title');
            const desc = document.getElementById('panel-desc');

            if(mode === 1) {
                // EXTERIOR
                title.innerText = "1. Exterior View";
                desc.innerText = "Standard view showing the Smart Screen interface, QR Code for public engagement, and wheels for mobility.";
            } 
            else if (mode === 2) {
                // SENSOR (X-RAY)
                title.innerText = "2. Sensor Logic";
                desc.innerText = "X-Ray View: See the ultrasonic sensor beaming down (Red) to calculate the 85% fill level.";
                
                binBody.material.opacity = 0.3; // Transparent
                qrMesh.visible = false;
                sensorBeam.visible = true;
            } 
            else if (mode === 3) {
                // RECYCLE
                title.innerText = "3. Recyclables (Blue)";
                desc.innerText = "Color-coded Blue for Paper/Plastic. Features a slot aperture to ensure correct sorting.";
                
                binBody.material.color.setHex(0x3498db); // Blue
                qrMesh.visible = false;
                // We could hide the screen here if desired, but smart bins usually keep screens.
            } 
            else if (mode === 4) {
                // ORGANIC COOLER
                title.innerText = "4. Organic + Cooler (Green)";
                desc.innerText = "Color-coded Green. Note the internal Cooling Unit (Blue Box) at the base to prevent decay.";
                
                binBody.material.color.setHex(0x27ae60); // Green
                binBody.material.opacity = 0.5; // Semi-transparent to see cooler
                qrMesh.visible = false;
                coolerUnit.visible = true;
            }
        }

        // Handle Window Resize
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

    </script>
</body>
</html>